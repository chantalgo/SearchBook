<?xml version="1.0" encoding="utf-8"?>
<s:WindowedApplication xmlns:fx="http://ns.adobe.com/mxml/2009"
					   xmlns:s="library://ns.adobe.com/flex/spark"
					   xmlns:mx="library://ns.adobe.com/flex/mx"
					   xmlns:ns1="*"
					   creationComplete="windowedapplication1_creationCompleteHandler(event)"
					   width.AllSearch="1100" height.AllSearch="900"
					   width.EventsSearch="1100" height.EventsSearch="900"
					   width.GroupsSearch="1100" height.GroupsSearch="900"
					   height.loggedIn="900"
					   width.PagesSearch="1100" height.PagesSearch="900"
					   width.PeopleSearch="1100" height.PeopleSearch="900">
	<fx:Script>
		<![CDATA[
			import com.facebook.graph.FacebookDesktop;
			
			import mx.events.FlexEvent;
			
			protected function windowedapplication1_creationCompleteHandler(event:FlexEvent):void
			{
				FacebookDesktop.init("279597868748971", loginHandler );
				
			}
			protected function loginHandler(success:Object,fail:Object):void { 
				if(success){ 
					currentState="loggedIn";
					nameLbl.text=success.user.name;
					userImg.source=FacebookDesktop.getImageUrl(success.uid,"small");
					birthdayLbl.text=success.user.birthday;
					FacebookDesktop.api("/me/statuses",getStatusHandler);
					
				}
			}
			protected function login():void
			{
				FacebookDesktop.login(loginHandler, ["user_birthday","read_stream", "friends_location"]);
				
			}
			protected function logout():void { 
				FacebookDesktop.logout(); 
				currentState="loggedOut";
			}
			protected function getStatusHandler(result:Object, fail:Object):void {
				statusLbl.text=result[0].message;
			}

			protected function userDisplayFunction(result:Object, fail:Object):void{
					var resultInfo:InformationDisplay;
					var toolTipInfo:String = new String();
					
					if(!(result.location == undefined)){
						if(result.location.hasOwnProperty("name"))
							toolTipInfo = result.location.name;
					}
					else{
						toolTipInfo = "no result";
					}
					resultInfo = new InformationDisplay(result.name, "https://facebook.com/" + result.id, FacebookDesktop.getImageUrl(result.id,"small"), toolTipInfo) ;
					peopleResults.addElement(resultInfo);
				
			}
			protected function groupDisplayFunction(result:Object, fail:Object):void{
				var resultInfo:InformationDisplay;
				var toolTipInfo:String = new String();
				
				if(result.hasOwnProperty("description"))
					toolTipInfo = result.description;
				
				else{
					toolTipInfo = "no result";
				}
				resultInfo = new InformationDisplay(result.name, "https://facebook.com/" + result.id, FacebookDesktop.getImageUrl(result.id,"small"), toolTipInfo);
				groupResults.addElement(resultInfo);
				
			}
			protected function eventDisplayFunction(result:Object, fail:Object):void{
				var resultInfo:InformationDisplay;
				var toolTipInfo:String = new String();
				
				if(result.hasOwnProperty("location"))
					toolTipInfo = result.location;
				else{
					toolTipInfo = "no result";
				}
				resultInfo = new InformationDisplay(result.name, "https://facebook.com/" + result.id, FacebookDesktop.getImageUrl(result.id,"small"), toolTipInfo) ;
				eventResults.addElement(resultInfo);
				
			}
			protected function pageDisplayFunction(result:Object, fail:Object):void{
				var resultInfo:InformationDisplay;
				var toolTipInfo:String = new String();
				
				if(result.hasOwnProperty("category"))
					toolTipInfo = result.category;
				else{
					toolTipInfo = "no result";
				}
				resultInfo = new InformationDisplay(result.name, "https://facebook.com/" + result.id, FacebookDesktop.getImageUrl(result.id,"small"), toolTipInfo) ;
				pageResults.addElement(resultInfo);
				
			}
			
			protected function userSearchResults(result:Object, fail:Object):void {
				var count:int = 0;
				
					//check index of array don't go out of Bounds
					while (count < 5){
						FacebookDesktop.api(result[count].id, userDisplayFunction);
						count++;
					}		
			}
			protected function groupSearchResults(result:Object, fail:Object):void {
				
				var count:int = 0;

					while (count < 5){
						FacebookDesktop.api(result[count].id, groupDisplayFunction);
						count++;
					}
			}
			protected function eventSearchResults(result:Object, fail:Object):void {
				
				var count:int = 0;

					while (count < 5){
						FacebookDesktop.api(result[count].id, eventDisplayFunction);
						count++;
					}
			}
			protected function pageSearchResults(result:Object, fail:Object):void {
				var count:int = 0;
				

					while (count < 5){
						FacebookDesktop.api(result[count].id, pageDisplayFunction);
						count++;
					}
			}

			
			protected function searchBtn_clickHandler(event:MouseEvent):void
			{
				var tittle:Label = new Label;
				
				switch (radiogroup1.selection) {
					case all :
						this.currentState = "AllSearch";
						peopleResults.removeAllElements();
						groupResults.removeAllElements();
						eventResults.removeAllElements();
						pageResults.removeAllElements();
						tittle.text = "People";
						peopleResults.addElement(tittle);
						var tittle2:Label = new Label;
						tittle2.text = "Groups";
						groupResults.addElement(tittle2);
						var tittle3:Label = new Label;
						tittle3.text = "Events";
						eventResults.addElement(tittle3);
						var tittle4:Label = new Label;
						tittle4.text = "Pages";
						pageResults.addElement(tittle4);
						FacebookDesktop.api("search", userSearchResults, {q:searchBox.text, type:'user'});
						FacebookDesktop.api("search", groupSearchResults, {q:searchBox.text, type:'group'});
						FacebookDesktop.api("search", eventSearchResults, {q:searchBox.text, type:'event'});
						FacebookDesktop.api("search", pageSearchResults, {q:searchBox.text, type:'page'});
						break;
					case people :
						this.currentState = "PeopleSearch";
						peopleResults.removeAllElements();
						tittle.text = "People";
						peopleResults.addElement(tittle);
						FacebookDesktop.api("search", userSearchResults, {q:searchBox.text, type:'user'});
						break;
					case groups :
						this.currentState = "GroupsSearch";
						groupResults.removeAllElements();
						tittle.text = "Groups";
						groupResults.addElement(tittle);
						FacebookDesktop.api("search", groupSearchResults, {q:searchBox.text, type:'group'});
						break;
					case events :
						this.currentState = "EventsSearch";
						eventResults.removeAllElements();
						tittle.text = "Events";
						eventResults.addElement(tittle);
						FacebookDesktop.api("search", eventSearchResults, {q:searchBox.text, type:'event'});
						break;
					case pages :
						this.currentState = "PagesSearch";
						pageResults.removeAllElements();
						tittle.text = "Pages";
						pageResults.addElement(tittle);
						FacebookDesktop.api("search", pageSearchResults, {q:searchBox.text, type:'page'});
						break;
					
				}
				
				
			}
			
			
		]]>
	</fx:Script>
	<s:states>
		<s:State name="loggedOut"/>
		<s:State name="loggedIn"/>
		<s:State name="AllSearch"/>
		<s:State name="PeopleSearch"/>
		<s:State name="GroupsSearch"/>
		<s:State name="EventsSearch"/>
		<s:State name="PagesSearch"/>
	</s:states>
	<fx:Declarations>
		<s:RadioButtonGroup id="radiogroup1"/>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	<s:layout.AllSearch>
		<s:BasicLayout/>
	</s:layout.AllSearch>
	<s:layout.loggedOut>
		<s:BasicLayout/>
	</s:layout.loggedOut>
	<s:layout.PeopleSearch>
		<s:BasicLayout/>
	</s:layout.PeopleSearch>
	<s:layout.GroupsSearch>
		<s:BasicLayout/>
	</s:layout.GroupsSearch>
	<s:layout.EventsSearch>
		<s:BasicLayout/>
	</s:layout.EventsSearch>
	<s:layout.PagesSearch>
		<s:BasicLayout/>
	</s:layout.PagesSearch>
	<s:HGroup includeIn="EventsSearch,AllSearch,PeopleSearch,PagesSearch,loggedIn,GroupsSearch"
			  width="409" height="200"
			  x.AllSearch="10" y.AllSearch="85"
			  x.EventsSearch="10" y.EventsSearch="64" width.EventsSearch="355"
			  x.GroupsSearch="10" y.GroupsSearch="66" width.GroupsSearch="355"
			  x.loggedIn="10" y.loggedIn="63"
			  x.PagesSearch="10" y.PagesSearch="81" width.PagesSearch="355"
			  x.PeopleSearch="10" y.PeopleSearch="78" width.PeopleSearch="355">
		<s:Image id="userImg" width="50"
				 left.AllSearch="10" top.AllSearch="10"
				 left.EventsSearch="10" top.EventsSearch="10"
				 left.GroupsSearch="10" top.GroupsSearch="10"
				 left.PagesSearch="10" top.PagesSearch="10"
				 left.PeopleSearch="10" top.PeopleSearch="10"/>
		<s:Form>
			<s:FormItem label="User">
				<s:Label id="nameLbl"/>
			</s:FormItem>
			<s:FormItem label="Birthday">
				<s:Label id="birthdayLbl"/>
			</s:FormItem>
			<s:FormItem label="Status">
				<s:Label id="statusLbl"/>
			</s:FormItem>
		</s:Form>
	</s:HGroup>
	<s:Form includeIn="EventsSearch,AllSearch,PeopleSearch,PagesSearch,loggedIn,GroupsSearch"
			width="394" height="283"
			x.AllSearch="10" y.AllSearch="371"
			x.EventsSearch="14" y.EventsSearch="349" width.EventsSearch="344"
			x.GroupsSearch="14" y.GroupsSearch="351" width.GroupsSearch="344"
			x.loggedIn="11" y.loggedIn="332"
			x.PagesSearch="14" y.PagesSearch="366" width.PagesSearch="344"
			x.PeopleSearch="14" y.PeopleSearch="363" width.PeopleSearch="344">
		<s:FormItem width="177"
					width.loggedIn="345">
			<s:layout>
				<s:HorizontalLayout/>
			</s:layout>
			<s:TextInput id="searchBox"/>
			<s:Button id="searchBtn" label="Search" click="searchBtn_clickHandler(event)"/>
		</s:FormItem>
		<s:RadioButton id="all" label="All" groupName="radiogroup1"
					   selected.AllSearch="true"
					   selected.EventsSearch="false"
					   selected.GroupsSearch="false"
					   selected.loggedIn="true"
					   selected.PagesSearch="false"
					   selected.PeopleSearch="false"/>
		<s:RadioButton id="people" label="People" groupName="radiogroup1"
					   selected.AllSearch="false"
					   selected.EventsSearch="false"
					   selected.GroupsSearch="false"
					   selected.loggedIn="false"
					   selected.PagesSearch="false"
					   selected.PeopleSearch="true"/>
		<s:RadioButton id="groups" label="Groups" groupName="radiogroup1"
					   selected.AllSearch="false"
					   selected.EventsSearch="false"
					   selected.GroupsSearch="true"
					   selected.loggedIn="false"
					   selected.PagesSearch="false"
					   selected.PeopleSearch="false"/>
		<s:RadioButton id="events" label="Events" groupName="radiogroup1"
					   selected.AllSearch="false"
					   selected.EventsSearch="true"
					   selected.GroupsSearch="false"
					   selected.loggedIn="false"
					   selected.PagesSearch="false"
					   selected.PeopleSearch="false"/>
		<s:RadioButton id="pages" label="Pages" groupName="radiogroup1" selected="true"
					   selected.AllSearch="false"
					   selected.EventsSearch="false"
					   selected.GroupsSearch="false"
					   selected.loggedIn="false"
					   selected.PagesSearch="true"
					   selected.PeopleSearch="false"/>
	</s:Form>
	<s:Group id="displayGroup" x="586" y="19" width="420" height="507"
			 x.AllSearch="423" y.AllSearch="95" width.AllSearch="548" height.AllSearch="715"
			 x.EventsSearch="393" y.EventsSearch="83" width.EventsSearch="585"
			 height.EventsSearch="678"
			 x.GroupsSearch="378" y.GroupsSearch="76" width.GroupsSearch="599"
			 height.GroupsSearch="665"
			 x.loggedIn="586" y.loggedIn="72"
			 x.PagesSearch="369" y.PagesSearch="91" width.PagesSearch="605" height.PagesSearch="648"
			 x.PeopleSearch="388" y.PeopleSearch="88" width.PeopleSearch="556"
			 height.PeopleSearch="649">
		<ns1:CircleDrawer x="150" y="200" width="52" height="58"/>
		<ns1:RectangleDrawer x="150" y="200" width="52" height="58" />
		<s:VGroup id="peopleResults" includeIn="AllSearch,PeopleSearch" x="22" y="10" width="200"
				  height="200" horizontalAlign="center"
				  width.PeopleSearch="485" height.PeopleSearch="614">
			
		</s:VGroup>
		<s:VGroup id="groupResults" includeIn="AllSearch,GroupsSearch" x="300" y="10" width="200"
				  height="200" horizontalAlign="center"
				  x.GroupsSearch="24" y.GroupsSearch="10" width.GroupsSearch="517"
				  height.GroupsSearch="624">
			
		</s:VGroup>
		<s:VGroup id="eventResults" includeIn="AllSearch,EventsSearch" x="22" y="510" width="200"
				  height="200" horizontalAlign="center"
				  x.EventsSearch="48" y.EventsSearch="17" width.EventsSearch="490"
				  height.EventsSearch="608">
			
		</s:VGroup>
		<s:VGroup id="pageResults" includeIn="AllSearch,PagesSearch" x="300" y="510" width="200"
				  height="200" horizontalAlign="center"
				  x.PagesSearch="32" y.PagesSearch="15" width.PagesSearch="545"
				  height.PagesSearch="600">
			
		</s:VGroup>
	</s:Group>
	<s:Image id="searchbooktitleBar" source="assets/searchbook_title.png"
			 x.AllSearch="1" y.AllSearch="1"
			 x.EventsSearch="-1" y.EventsSearch="1"
			 x.GroupsSearch="1" y.GroupsSearch="1"
			 left.loggedIn="1" top.loggedIn="1"
			 x.loggedOut="1" y.loggedOut="-1"
			 x.PagesSearch="0" y.PagesSearch="0"
			 x.PeopleSearch="0" y.PeopleSearch="0"/>
	<s:Button id="loginoutBtn0" includeIn="loggedOut" right="19" top="10" label="Log In"
			  click="login()" skinClass="skins.FBLoginButtonSkin"/>
	<s:Button id="loginoutBtn1" includeIn="loggedIn" right="10" top="13" label="Log Out"
			  click="logout()" skinClass="skins.FBLogoutButtonSkin"/>
	<s:Button id="loginoutBtn2" includeIn="AllSearch" right="10" top="11" label="Log Out"
			  click="logout()" skinClass="skins.FBLogoutButtonSkin"/>
	<s:Button id="loginoutBtn3" includeIn="PeopleSearch" right="10" top="13" label="Log Out"
			  click="logout()" skinClass="skins.FBLogoutButtonSkin"/>
	<s:Button id="loginoutBtn4" includeIn="GroupsSearch" right="10" top="13" label="Log Out"
			  click="logout()" skinClass="skins.FBLogoutButtonSkin"/>
	<s:Button id="loginoutBtn5" includeIn="EventsSearch" right="10" top="12" label="Log Out"
			  click="logout()" skinClass="skins.FBLogoutButtonSkin"/>
	<s:Button id="loginoutBtn" includeIn="PagesSearch" right="10" top="14" label="Log Out"
			  click="logout()" skinClass="skins.FBLogoutButtonSkin"/>
	<mx:LinkButton id="helpLink" label="help"
				   click="navigateToURL(new URLRequest('http://www.cs.columbia.edu/~cg2486/ui/searchbook/user_manual.html'),'User Manual')"
				   color="#FFFFFF" enabled="true" fontFamily="Verdana" textDecoration="underline"
				   right.AllSearch="129" top.AllSearch="12"
				   right.EventsSearch="107" top.EventsSearch="10"
				   right.GroupsSearch="118" top.GroupsSearch="13"
				   right.loggedIn="107" top.loggedIn="11"
				   right.loggedOut="121" top.loggedOut="11"
				   right.PagesSearch="108" top.PagesSearch="12"
				   right.PeopleSearch="109" top.PeopleSearch="13"/>
	
</s:WindowedApplication>
